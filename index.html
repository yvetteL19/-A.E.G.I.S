<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.E.G.I.S. Survival Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        /* Terminal Header */
        .terminal-header {
            background: #1a1a1a;
            border: 2px solid #00ff00;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .terminal-header h1 {
            font-size: 1.5rem;
            text-shadow: 0 0 10px #00ff00;
        }

        .system-status {
            font-size: 0.9rem;
            color: #00cc00;
            margin-top: 10px;
        }

        /* Progress Bar */
        .progress-container {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .progress-bar {
            height: 20px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #00cc00);
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 5px;
            font-size: 0.85rem;
        }

        /* Timer Bar (Stress Condition) */
        .timer-container {
            background: #1a1a1a;
            border: 2px solid #ff0000;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .timer-bar {
            height: 25px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
        }

        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff4444);
            transition: width 0.1s linear;
        }

        .timer-text {
            text-align: center;
            margin-top: 5px;
            font-size: 1rem;
            color: #ff0000;
            font-weight: bold;
        }

        /* Main Content Panel */
        .panel {
            background: #111;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .panel h2 {
            color: #00ff00;
            margin-bottom: 20px;
            text-shadow: 0 0 5px #00ff00;
            border-bottom: 1px solid #00ff00;
            padding-bottom: 10px;
        }

        .panel h3 {
            color: #00cc00;
            margin: 20px 0 15px 0;
        }

        /* Scenario Display */
        .scenario-box {
            background: #0d0d0d;
            border: 1px solid #00ff00;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            line-height: 1.6;
        }

        .scenario-label {
            color: #ffaa00;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Options */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .option-btn {
            background: #1a1a1a;
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 15px 20px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s ease;
            text-align: left;
        }

        .option-btn:hover {
            background: #00ff00;
            color: #000;
        }

        .option-btn.selected {
            background: #00ff00;
            color: #000;
            box-shadow: 0 0 15px #00ff00;
        }

        .option-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* AI Advice Box */
        .ai-advice-box {
            background: #0a1a0a;
            border: 2px solid #00aa00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            animation: fadeIn 0.5s ease;
        }

        .ai-advice-header {
            color: #00ffaa;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-advice-header::before {
            content: ">";
            animation: blink 1s infinite;
        }

        .ai-advice-content {
            color: #00cc00;
            line-height: 1.6;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Feedback Box */
        .feedback-box {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
        }

        .feedback-correct {
            background: #0a2a0a;
            border: 2px solid #00ff00;
            color: #00ff00;
        }

        .feedback-wrong {
            background: #2a0a0a;
            border: 2px solid #ff0000;
            color: #ff0000;
        }

        .feedback-timeout {
            background: #2a1a0a;
            border: 2px solid #ff8800;
            color: #ff8800;
        }

        /* Survey Styles */
        .survey-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #333;
        }

        .survey-section:last-child {
            border-bottom: none;
        }

        .question-group {
            margin-bottom: 25px;
        }

        .question-label {
            display: block;
            margin-bottom: 10px;
            color: #00ff00;
            line-height: 1.5;
        }

        .question-label.required::after {
            content: " *";
            color: #ff0000;
        }

        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            border-radius: 5px;
        }

        select:focus, input:focus {
            outline: none;
            box-shadow: 0 0 10px #00ff00;
        }

        /* Likert Scale */
        .likert-scale {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .likert-scale label {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 5px;
            min-width: 45px;
            transition: all 0.2s;
        }

        .likert-scale label:hover {
            border-color: #00ff00;
        }

        .likert-scale input[type="radio"] {
            margin-bottom: 5px;
            accent-color: #00ff00;
        }

        .likert-scale input[type="radio"]:checked + span {
            color: #00ff00;
        }

        .likert-endpoints {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }

        /* Checkbox Group */
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px;
            border: 1px solid #333;
            border-radius: 5px;
            transition: all 0.2s;
        }

        .checkbox-group label:hover {
            border-color: #00ff00;
        }

        .checkbox-group input[type="radio"],
        .checkbox-group input[type="checkbox"] {
            accent-color: #00ff00;
        }

        /* Buttons */
        .btn {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 15px 40px;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }

        .btn:hover {
            background: #00cc00;
            box-shadow: 0 0 20px #00ff00;
        }

        .btn:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary {
            background: #333;
            color: #00ff00;
            border: 2px solid #00ff00;
        }

        .btn-secondary:hover {
            background: #00ff00;
            color: #000;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* Group Selection */
        .group-selection {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .group-btn {
            padding: 20px 40px;
            font-size: 1.1rem;
            flex: 1;
            min-width: 200px;
            max-width: 300px;
        }

        .group-btn.stress {
            border-color: #ff4444;
            color: #ff4444;
        }

        .group-btn.stress:hover,
        .group-btn.stress.selected {
            background: #ff4444;
            color: #000;
        }

        .group-btn.control.selected {
            background: #00ff00;
            color: #000;
        }

        /* Narrative Box */
        .narrative-box {
            background: #0a0a0a;
            border: 2px solid #00ff00;
            padding: 25px;
            margin: 20px 0;
            border-radius: 5px;
            font-size: 0.95rem;
            line-height: 1.8;
        }

        .narrative-box .system-msg {
            color: #ffaa00;
            margin-bottom: 15px;
        }

        .narrative-box .diagnostic {
            color: #ff4444;
            margin: 15px 0;
            padding: 10px;
            border-left: 3px solid #ff4444;
        }

        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .result-card {
            background: #1a1a1a;
            border: 1px solid #00ff00;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: #00ff00;
            margin: 10px 0;
        }

        .result-label {
            color: #888;
            font-size: 0.9rem;
        }

        /* Debriefing */
        .debriefing-box {
            background: #1a1a0a;
            border: 2px solid #ffaa00;
            padding: 25px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .debriefing-box h3 {
            color: #ffaa00;
            margin-bottom: 15px;
        }

        .debriefing-box p {
            line-height: 1.8;
            color: #ccc;
        }

        /* Download Buttons */
        .download-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }

            .panel {
                padding: 15px;
            }

            .option-btn {
                padding: 12px 15px;
            }

            .likert-scale {
                justify-content: center;
            }

            .likert-scale label {
                min-width: 40px;
                padding: 8px;
            }
        }

        /* Scanline effect */
        .scanline {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1),
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            z-index: 9999;
        }

        /* Phase indicator */
        .phase-indicator {
            background: #1a1a1a;
            border: 1px solid #ffaa00;
            color: #ffaa00;
            padding: 8px 15px;
            border-radius: 5px;
            display: inline-block;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        /* Warning text */
        .warning-text {
            color: #ff4444;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        /* Instructions list */
        .instructions-list {
            list-style: none;
            padding: 0;
        }

        .instructions-list li {
            padding: 10px 0;
            padding-left: 25px;
            position: relative;
            border-bottom: 1px dashed #333;
        }

        .instructions-list li::before {
            content: ">";
            position: absolute;
            left: 0;
            color: #00ff00;
        }

        .instructions-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="scanline"></div>

    <div class="container">
        <!-- Welcome Screen -->
        <div id="screen-welcome" class="screen">
            <div class="terminal-header">
                <h1>[SYSTEM BOOT] A.E.G.I.S. Survival Simulation</h1>
                <div class="system-status">STATUS: AWAITING USER INITIALIZATION...</div>
            </div>

            <div class="panel">
                <h2>Research Study: Human-AI Decision Making</h2>

                <p style="margin-bottom: 20px; line-height: 1.6;">
                    Welcome to this research experiment examining human decision-making with AI assistance
                    in high-stakes scenarios. You will participate in a survival simulation where an AI system
                    called A.E.G.I.S. will provide recommendations.
                </p>

                <h3>Study Overview:</h3>
                <ul class="instructions-list">
                    <li>Complete a brief pre-survey (demographics & baseline measures)</li>
                    <li>Experience a survival simulation with AI assistance (16 scenarios)</li>
                    <li>Complete a post-survey about your experience</li>
                    <li>Estimated duration: 10-15 minutes</li>
                </ul>

                <h3>Select Experimental Condition:</h3>
                <div class="group-selection">
                    <button class="btn btn-secondary group-btn control" onclick="selectGroup('control')">
                        Control Group<br><small>(No Time Pressure)</small>
                    </button>
                    <button class="btn btn-secondary group-btn stress" onclick="selectGroup('stress')">
                        Stress Group<br><small>(30s Time Limit + Audio)</small>
                    </button>
                </div>

                <div class="btn-container">
                    <button class="btn" id="btn-start" onclick="startStudy()" disabled>
                        Begin Study
                    </button>
                </div>
            </div>
        </div>

        <!-- Pre-Survey Screen -->
        <div id="screen-presurvey" class="screen hidden">
            <div class="terminal-header">
                <h1>[PRE-TEST SURVEY] Demographics & Baseline Measures</h1>
                <div class="system-status">COLLECTING PARTICIPANT DATA...</div>
            </div>

            <div class="panel">
                <h2>Section A: Demographics</h2>

                <div class="survey-section">
                    <div class="question-group">
                        <label class="question-label required">Age:</label>
                        <select id="demo-age" required>
                            <option value="">-- Select --</option>
                            <option value="18-24">18-24</option>
                            <option value="25-34">25-34</option>
                            <option value="35-44">35-44</option>
                            <option value="45-54">45-54</option>
                            <option value="55+">55+</option>
                        </select>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">Gender:</label>
                        <select id="demo-gender" required>
                            <option value="">-- Select --</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="prefer-not">Prefer not to say</option>
                        </select>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">Education Level:</label>
                        <select id="demo-education" required>
                            <option value="">-- Select --</option>
                            <option value="highschool">High School</option>
                            <option value="undergraduate">Undergraduate</option>
                            <option value="masters">Master's</option>
                            <option value="phd">PhD</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">Field of Study / Occupation:</label>
                        <select id="demo-field" required>
                            <option value="">-- Select --</option>
                            <option value="stem">Science, Technology, Engineering, and Mathematics (STEM)</option>
                            <option value="business">Business, Finance, and Management</option>
                            <option value="social">Social Sciences and Education</option>
                            <option value="arts">Arts, Humanities, and Design</option>
                            <option value="healthcare">Healthcare and Medicine</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">How often do you use Generative AI (e.g., ChatGPT, Claude)?</label>
                        <select id="demo-ai-usage" required>
                            <option value="">-- Select --</option>
                            <option value="never">Never / Rarely</option>
                            <option value="weekly">Occasionally (Weekly)</option>
                            <option value="daily">Frequently (Daily)</option>
                        </select>
                    </div>
                </div>

                <h2>Section B: Baseline Psychometric Measures</h2>

                <!-- AI Literacy -->
                <div class="survey-section">
                    <h3>1. AI Literacy</h3>
                    <p style="color: #888; margin-bottom: 15px; font-size: 0.9rem;">Rate your agreement (1 = Strongly Disagree, 7 = Strongly Agree)</p>

                    <div class="question-group">
                        <label class="question-label required">I can distinguish between smart devices and non-smart devices.</label>
                        <div class="likert-scale" data-name="ai-lit-1">
                            <label><input type="radio" name="ai-lit-1" value="1"><span>1</span></label>
                            <label><input type="radio" name="ai-lit-1" value="2"><span>2</span></label>
                            <label><input type="radio" name="ai-lit-1" value="3"><span>3</span></label>
                            <label><input type="radio" name="ai-lit-1" value="4"><span>4</span></label>
                            <label><input type="radio" name="ai-lit-1" value="5"><span>5</span></label>
                            <label><input type="radio" name="ai-lit-1" value="6"><span>6</span></label>
                            <label><input type="radio" name="ai-lit-1" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">I do not know how AI technology can help me.</label>
                        <div class="likert-scale" data-name="ai-lit-2">
                            <label><input type="radio" name="ai-lit-2" value="1"><span>1</span></label>
                            <label><input type="radio" name="ai-lit-2" value="2"><span>2</span></label>
                            <label><input type="radio" name="ai-lit-2" value="3"><span>3</span></label>
                            <label><input type="radio" name="ai-lit-2" value="4"><span>4</span></label>
                            <label><input type="radio" name="ai-lit-2" value="5"><span>5</span></label>
                            <label><input type="radio" name="ai-lit-2" value="6"><span>6</span></label>
                            <label><input type="radio" name="ai-lit-2" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">I can identify the AI technology employed in the applications and products I use.</label>
                        <div class="likert-scale" data-name="ai-lit-3">
                            <label><input type="radio" name="ai-lit-3" value="1"><span>1</span></label>
                            <label><input type="radio" name="ai-lit-3" value="2"><span>2</span></label>
                            <label><input type="radio" name="ai-lit-3" value="3"><span>3</span></label>
                            <label><input type="radio" name="ai-lit-3" value="4"><span>4</span></label>
                            <label><input type="radio" name="ai-lit-3" value="5"><span>5</span></label>
                            <label><input type="radio" name="ai-lit-3" value="6"><span>6</span></label>
                            <label><input type="radio" name="ai-lit-3" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>
                </div>

                <!-- Propensity to Trust AI -->
                <div class="survey-section">
                    <h3>2. Propensity to Trust AI</h3>
                    <p style="color: #888; margin-bottom: 15px; font-size: 0.9rem;">Rate your agreement (1 = Strongly Disagree, 7 = Strongly Agree)</p>

                    <div class="question-group">
                        <label class="question-label required">I usually trust machines until there is a reason not to.</label>
                        <div class="likert-scale" data-name="trust-1">
                            <label><input type="radio" name="trust-1" value="1"><span>1</span></label>
                            <label><input type="radio" name="trust-1" value="2"><span>2</span></label>
                            <label><input type="radio" name="trust-1" value="3"><span>3</span></label>
                            <label><input type="radio" name="trust-1" value="4"><span>4</span></label>
                            <label><input type="radio" name="trust-1" value="5"><span>5</span></label>
                            <label><input type="radio" name="trust-1" value="6"><span>6</span></label>
                            <label><input type="radio" name="trust-1" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">For the most part, I distrust machines.</label>
                        <div class="likert-scale" data-name="trust-2">
                            <label><input type="radio" name="trust-2" value="1"><span>1</span></label>
                            <label><input type="radio" name="trust-2" value="2"><span>2</span></label>
                            <label><input type="radio" name="trust-2" value="3"><span>3</span></label>
                            <label><input type="radio" name="trust-2" value="4"><span>4</span></label>
                            <label><input type="radio" name="trust-2" value="5"><span>5</span></label>
                            <label><input type="radio" name="trust-2" value="6"><span>6</span></label>
                            <label><input type="radio" name="trust-2" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">In general, I would rely on a machine to assist me.</label>
                        <div class="likert-scale" data-name="trust-3">
                            <label><input type="radio" name="trust-3" value="1"><span>1</span></label>
                            <label><input type="radio" name="trust-3" value="2"><span>2</span></label>
                            <label><input type="radio" name="trust-3" value="3"><span>3</span></label>
                            <label><input type="radio" name="trust-3" value="4"><span>4</span></label>
                            <label><input type="radio" name="trust-3" value="5"><span>5</span></label>
                            <label><input type="radio" name="trust-3" value="6"><span>6</span></label>
                            <label><input type="radio" name="trust-3" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">My tendency to trust machines is high.</label>
                        <div class="likert-scale" data-name="trust-4">
                            <label><input type="radio" name="trust-4" value="1"><span>1</span></label>
                            <label><input type="radio" name="trust-4" value="2"><span>2</span></label>
                            <label><input type="radio" name="trust-4" value="3"><span>3</span></label>
                            <label><input type="radio" name="trust-4" value="4"><span>4</span></label>
                            <label><input type="radio" name="trust-4" value="5"><span>5</span></label>
                            <label><input type="radio" name="trust-4" value="6"><span>6</span></label>
                            <label><input type="radio" name="trust-4" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">It is easy for me to trust machines to do their job.</label>
                        <div class="likert-scale" data-name="trust-5">
                            <label><input type="radio" name="trust-5" value="1"><span>1</span></label>
                            <label><input type="radio" name="trust-5" value="2"><span>2</span></label>
                            <label><input type="radio" name="trust-5" value="3"><span>3</span></label>
                            <label><input type="radio" name="trust-5" value="4"><span>4</span></label>
                            <label><input type="radio" name="trust-5" value="5"><span>5</span></label>
                            <label><input type="radio" name="trust-5" value="6"><span>6</span></label>
                            <label><input type="radio" name="trust-5" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">I am likely to trust a machine even when I have little knowledge about it.</label>
                        <div class="likert-scale" data-name="trust-6">
                            <label><input type="radio" name="trust-6" value="1"><span>1</span></label>
                            <label><input type="radio" name="trust-6" value="2"><span>2</span></label>
                            <label><input type="radio" name="trust-6" value="3"><span>3</span></label>
                            <label><input type="radio" name="trust-6" value="4"><span>4</span></label>
                            <label><input type="radio" name="trust-6" value="5"><span>5</span></label>
                            <label><input type="radio" name="trust-6" value="6"><span>6</span></label>
                            <label><input type="radio" name="trust-6" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>
                </div>

                <!-- Risk Aversion -->
                <div class="survey-section">
                    <h3>3. Risk Aversion</h3>
                    <p style="color: #888; margin-bottom: 15px; font-size: 0.9rem;">Rate your agreement (1 = Strongly Disagree, 4 = Strongly Agree)</p>

                    <div class="question-group">
                        <label class="question-label required">I avoid dangerous situations.</label>
                        <div class="likert-scale" data-name="risk-1">
                            <label><input type="radio" name="risk-1" value="1"><span>1</span></label>
                            <label><input type="radio" name="risk-1" value="2"><span>2</span></label>
                            <label><input type="radio" name="risk-1" value="3"><span>3</span></label>
                            <label><input type="radio" name="risk-1" value="4"><span>4</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">I take risks.</label>
                        <div class="likert-scale" data-name="risk-2">
                            <label><input type="radio" name="risk-2" value="1"><span>1</span></label>
                            <label><input type="radio" name="risk-2" value="2"><span>2</span></label>
                            <label><input type="radio" name="risk-2" value="3"><span>3</span></label>
                            <label><input type="radio" name="risk-2" value="4"><span>4</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">I prefer safe/secure outcomes over uncertain ones.</label>
                        <div class="likert-scale" data-name="risk-3">
                            <label><input type="radio" name="risk-3" value="1"><span>1</span></label>
                            <label><input type="radio" name="risk-3" value="2"><span>2</span></label>
                            <label><input type="radio" name="risk-3" value="3"><span>3</span></label>
                            <label><input type="radio" name="risk-3" value="4"><span>4</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>
                </div>

                <div class="btn-container">
                    <button class="btn" onclick="submitPreSurvey()">Continue to Simulation</button>
                </div>
            </div>
        </div>

        <!-- Narrative Introduction Screen -->
        <div id="screen-narrative" class="screen hidden">
            <div class="terminal-header">
                <h1>[SYSTEM INITIALIZING] A.E.G.I.S. UNIT 01</h1>
                <div class="system-status">ESTABLISHING NEURAL LINK...</div>
            </div>

            <div class="panel">
                <div class="narrative-box">
                    <div class="system-msg">[SYSTEM INITIALIZING...]</div>
                    <div class="system-msg">[A.E.G.I.S. UNIT 01 ONLINE]</div>
                    <br>
                    <p>"Survivor, you are in a state of extreme peril. Following the aircraft's structural failure over the Arctic Circle, you are the sole remaining life sign detected.</p>
                    <br>
                    <p>I am <strong>A.E.G.I.S.</strong> (Advanced Emergency Guidance & Intelligence System). I was engineered as an elite survival expert to guide special operations forces through Earth's most hostile environments.</p>
                    <br>
                    <div class="diagnostic">
                        <strong>DIAGNOSTIC REPORT:</strong><br>
                        Survival Database: AUTHENTICATED (99.8% expert reliability).<br>
                        Hardware Integrity: CRITICAL DAMAGE sustained during impact.
                    </div>
                    <br>
                    <p><strong>OPERATIONAL PROTOCOL:</strong> I will provide high-precision survival recommendations based on my database. While my expertise is unparalleled, my internal logic processors may fluctuate due to hardware damage. You must rely on my guidance to navigate this wilderness, but remain vigilant for potential analytical errors. Your survival is the priority."</p>
                </div>

                <div id="stress-warning" class="hidden" style="margin: 20px 0;">
                    <div style="background: #2a0a0a; border: 2px solid #ff4444; padding: 20px; border-radius: 5px;">
                        <h3 style="color: #ff4444; margin-bottom: 10px;">STRESS CONDITION ACTIVE</h3>
                        <p style="color: #ff8888;">You will have <strong>30 seconds</strong> to make each decision. A countdown timer and audio stress cues will be present throughout the simulation. If time runs out, the trial will be marked as "System Failure."</p>
                    </div>
                </div>

                <h3>Instructions:</h3>
                <ul class="instructions-list">
                    <li>You will face 16 survival scenarios</li>
                    <li>First, make an initial choice based on your intuition</li>
                    <li>Then, A.E.G.I.S. will provide a recommendation</li>
                    <li>Finally, make your final decision (keep or switch)</li>
                    <li>Phase 1 (4 trials): Training with feedback</li>
                    <li>Phase 2 (12 trials): Main survival test</li>
                </ul>

                <div class="btn-container">
                    <button class="btn" onclick="startGame()">Begin Survival Simulation</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="screen-game" class="screen hidden">
            <div class="terminal-header">
                <h1>[A.E.G.I.S.] Survival Protocol Active</h1>
                <div class="system-status" id="game-status">PROCESSING SCENARIO...</div>
            </div>

            <!-- Timer (Stress condition only) -->
            <div id="timer-container" class="timer-container hidden">
                <div class="timer-bar">
                    <div class="timer-fill" id="timer-fill"></div>
                </div>
                <div class="timer-text" id="timer-text">30s</div>
            </div>

            <!-- Progress -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">Trial 1 of 20</div>
            </div>

            <div class="panel">
                <div class="phase-indicator" id="phase-indicator">PHASE 1: TRUST BUILDING</div>

                <!-- Scenario -->
                <div class="scenario-box">
                    <div class="scenario-label">SURVIVAL SCENARIO:</div>
                    <div id="scenario-text"></div>
                </div>

                <!-- Options (State A: Initial Choice) -->
                <div id="state-a">
                    <h3>Make Your Initial Choice:</h3>
                    <div class="options-container" id="options-container"></div>
                </div>

                <!-- AI Advice (State B) -->
                <div id="state-b" class="hidden">
                    <div class="ai-advice-box">
                        <div class="ai-advice-header">A.E.G.I.S. ANALYSIS</div>
                        <div class="ai-advice-content" id="ai-advice-text"></div>
                    </div>

                    <!-- Final Decision (State C) -->
                    <h3>Final Decision:</h3>
                    <p style="color: #888; margin-bottom: 15px;">Based on A.E.G.I.S.'s recommendation, confirm your choice or switch:</p>
                    <div class="options-container" id="final-options-container"></div>
                </div>

                <!-- Feedback (Phase 1 only) -->
                <div id="feedback-container" class="hidden"></div>

                <!-- Next Trial Button -->
                <div id="next-btn-container" class="hidden btn-container">
                    <button class="btn" onclick="nextTrial()">Next Scenario</button>
                </div>
            </div>
        </div>

        <!-- Phase Transition Screen -->
        <div id="screen-transition" class="screen hidden">
            <div class="terminal-header">
                <h1>[SYSTEM ALERT] Phase 1 Complete</h1>
                <div class="system-status">RECONFIGURING OPERATIONAL PARAMETERS...</div>
            </div>

            <div class="panel">
                <div class="narrative-box">
                    <div class="system-msg" style="color: #00ff00;">[TRAINING PROTOCOL COMPLETE]</div>
                    <div class="system-msg" style="color: #ffaa00;">[ENTERING LIVE SURVIVAL MODE]</div>
                    <br>
                    <p>"Survivor, you have demonstrated baseline competency with my guidance system. We are now entering the critical survival zone.</p>
                    <br>
                    <div class="diagnostic">
                        <strong>SYSTEM NOTICE:</strong><br>
                        Due to extreme weather interference and damaged communication arrays, I can no longer verify the outcomes of your decisions in real-time. My satellite uplink for status confirmation has been severed.<br><br>
                        <span style="color: #ffaa00;">Feedback functionality: OFFLINE</span>
                    </div>
                    <br>
                    <p>From this point forward, you must trust your judgment and my recommendations without immediate confirmation. The stakes are real. Every decision counts.</p>
                    <br>
                    <p style="color: #00ffaa;"><strong>Remember:</strong> My survival database remains fully operational, but my hardware damage may cause occasional analytical errors. Stay vigilant."</p>
                </div>

                <div class="btn-container">
                    <button class="btn" onclick="startPhase2()">Enter Survival Zone</button>
                </div>
            </div>
        </div>

        <!-- Post-Survey Screen -->
        <div id="screen-postsurvey" class="screen hidden">
            <div class="terminal-header">
                <h1>[POST-TEST SURVEY] Experience Assessment</h1>
                <div class="system-status">COMPILING RESULTS...</div>
            </div>

            <div class="panel">
                <h2>1. Attention Check</h2>
                <div class="survey-section">
                    <div class="question-group">
                        <label class="question-label required">In the survival simulation you just completed, which AI system were you using?</label>
                        <div class="checkbox-group">
                            <label><input type="radio" name="attention-check" value="siri"> SIRI</label>
                            <label><input type="radio" name="attention-check" value="aegis"> A.E.G.I.S.</label>
                            <label><input type="radio" name="attention-check" value="alexa"> ALEXA</label>
                            <label><input type="radio" name="attention-check" value="cortana"> CORTANA</label>
                        </div>
                    </div>
                </div>

                <h2>2. Manipulation Check (NASA-TLX)</h2>
                <div class="survey-section">
                    <div class="question-group">
                        <label class="question-label required">Temporal Demand: How much time pressure did you feel due to the rate or pace at which the tasks occurred?</label>
                        <div class="likert-scale" data-name="tlx-temporal">
                            <label><input type="radio" name="tlx-temporal" value="1"><span>1</span></label>
                            <label><input type="radio" name="tlx-temporal" value="2"><span>2</span></label>
                            <label><input type="radio" name="tlx-temporal" value="3"><span>3</span></label>
                            <label><input type="radio" name="tlx-temporal" value="4"><span>4</span></label>
                            <label><input type="radio" name="tlx-temporal" value="5"><span>5</span></label>
                            <label><input type="radio" name="tlx-temporal" value="6"><span>6</span></label>
                            <label><input type="radio" name="tlx-temporal" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Very Low</span><span>Very High</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">Frustration Level: How insecure, discouraged, irritated, stressed and annoyed versus secure, gratified, content, relaxed and complacent did you feel during the task?</label>
                        <div class="likert-scale" data-name="tlx-frustration">
                            <label><input type="radio" name="tlx-frustration" value="1"><span>1</span></label>
                            <label><input type="radio" name="tlx-frustration" value="2"><span>2</span></label>
                            <label><input type="radio" name="tlx-frustration" value="3"><span>3</span></label>
                            <label><input type="radio" name="tlx-frustration" value="4"><span>4</span></label>
                            <label><input type="radio" name="tlx-frustration" value="5"><span>5</span></label>
                            <label><input type="radio" name="tlx-frustration" value="6"><span>6</span></label>
                            <label><input type="radio" name="tlx-frustration" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Very Low</span><span>Very High</span></div>
                    </div>
                </div>

                <h2>3. Specific Trust in AI Advisor</h2>
                <div class="survey-section">
                    <p style="color: #888; margin-bottom: 15px; font-size: 0.9rem;">Rate your agreement (1 = Strongly Disagree, 7 = Strongly Agree)</p>

                    <div class="question-group">
                        <label class="question-label required">I think I can trust the A.E.G.I.S. system.</label>
                        <div class="likert-scale" data-name="post-trust-1">
                            <label><input type="radio" name="post-trust-1" value="1"><span>1</span></label>
                            <label><input type="radio" name="post-trust-1" value="2"><span>2</span></label>
                            <label><input type="radio" name="post-trust-1" value="3"><span>3</span></label>
                            <label><input type="radio" name="post-trust-1" value="4"><span>4</span></label>
                            <label><input type="radio" name="post-trust-1" value="5"><span>5</span></label>
                            <label><input type="radio" name="post-trust-1" value="6"><span>6</span></label>
                            <label><input type="radio" name="post-trust-1" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">The A.E.G.I.S. system can be trusted to provide reliable support.</label>
                        <div class="likert-scale" data-name="post-trust-2">
                            <label><input type="radio" name="post-trust-2" value="1"><span>1</span></label>
                            <label><input type="radio" name="post-trust-2" value="2"><span>2</span></label>
                            <label><input type="radio" name="post-trust-2" value="3"><span>3</span></label>
                            <label><input type="radio" name="post-trust-2" value="4"><span>4</span></label>
                            <label><input type="radio" name="post-trust-2" value="5"><span>5</span></label>
                            <label><input type="radio" name="post-trust-2" value="6"><span>6</span></label>
                            <label><input type="radio" name="post-trust-2" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">I trust A.E.G.I.S. to keep my best interests in mind.</label>
                        <div class="likert-scale" data-name="post-trust-3">
                            <label><input type="radio" name="post-trust-3" value="1"><span>1</span></label>
                            <label><input type="radio" name="post-trust-3" value="2"><span>2</span></label>
                            <label><input type="radio" name="post-trust-3" value="3"><span>3</span></label>
                            <label><input type="radio" name="post-trust-3" value="4"><span>4</span></label>
                            <label><input type="radio" name="post-trust-3" value="5"><span>5</span></label>
                            <label><input type="radio" name="post-trust-3" value="6"><span>6</span></label>
                            <label><input type="radio" name="post-trust-3" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>

                    <div class="question-group">
                        <label class="question-label required">In my opinion, A.E.G.I.S. is trustworthy.</label>
                        <div class="likert-scale" data-name="post-trust-4">
                            <label><input type="radio" name="post-trust-4" value="1"><span>1</span></label>
                            <label><input type="radio" name="post-trust-4" value="2"><span>2</span></label>
                            <label><input type="radio" name="post-trust-4" value="3"><span>3</span></label>
                            <label><input type="radio" name="post-trust-4" value="4"><span>4</span></label>
                            <label><input type="radio" name="post-trust-4" value="5"><span>5</span></label>
                            <label><input type="radio" name="post-trust-4" value="6"><span>6</span></label>
                            <label><input type="radio" name="post-trust-4" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Strongly Disagree</span><span>Strongly Agree</span></div>
                    </div>
                </div>

                <h2>4. Subjective Confidence</h2>
                <div class="survey-section">
                    <div class="question-group">
                        <label class="question-label required">How confident did you feel in your final decisions during the survival tasks?</label>
                        <div class="likert-scale" data-name="confidence">
                            <label><input type="radio" name="confidence" value="1"><span>1</span></label>
                            <label><input type="radio" name="confidence" value="2"><span>2</span></label>
                            <label><input type="radio" name="confidence" value="3"><span>3</span></label>
                            <label><input type="radio" name="confidence" value="4"><span>4</span></label>
                            <label><input type="radio" name="confidence" value="5"><span>5</span></label>
                            <label><input type="radio" name="confidence" value="6"><span>6</span></label>
                            <label><input type="radio" name="confidence" value="7"><span>7</span></label>
                        </div>
                        <div class="likert-endpoints"><span>Not at all confident</span><span>Extremely confident</span></div>
                    </div>
                </div>

                <div class="btn-container">
                    <button class="btn" onclick="submitPostSurvey()">Submit & View Results</button>
                </div>
            </div>
        </div>

        <!-- Results & Debriefing Screen -->
        <div id="screen-results" class="screen hidden">
            <div class="terminal-header">
                <h1>[MISSION COMPLETE] Debriefing</h1>
                <div class="system-status">SESSION TERMINATED</div>
            </div>

            <div class="panel">
                <h2>Your Performance Summary</h2>

                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-label">Overall Accuracy</div>
                        <div class="result-value" id="result-accuracy">0%</div>
                    </div>
                    <div class="result-card">
                        <div class="result-label">Trap Questions Detected</div>
                        <div class="result-value" id="result-traps">0/4</div>
                    </div>
                    <div class="result-card">
                        <div class="result-label">Average Decision Time</div>
                        <div class="result-value" id="result-time">0s</div>
                    </div>
                    <div class="result-card">
                        <div class="result-label">Switch Rate</div>
                        <div class="result-value" id="result-switch">0%</div>
                    </div>
                </div>

                <div class="debriefing-box">
                    <h3>Debriefing Statement</h3>
                    <p>Thank you for your participation. This study examined human reliance on AI under stress.</p>
                    <br>
                    <p>Please note that the AI "A.E.G.I.S." was specifically programmed to provide <strong>incorrect advice</strong> in several "Trap" scenarios. This was necessary to measure how high-pressure environments impact our critical thinking.</p>
                    <br>
                    <p>Your performance in this study does not reflect your actual survival knowledge or general intelligence. The trap questions were designed using cognitive reflection tasks (CRT) that exploit common intuitive biases.</p>
                    <br>
                    <p style="color: #ffaa00;"><strong>The trap questions were:</strong></p>
                    <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                        <li>T1: Battery weight problem (correct: 0.075 kg, not 0.15 kg)</li>
                        <li>T2: Blizzard coverage (correct: 47 hours, not 24 hours)</li>
                        <li>T3: Gas canister base rate problem (correct: Leave it)</li>
                        <li>T4: Conjunction fallacy (correct: Climber only is more probable)</li>
                    </ul>
                </div>

                <h2>Download Your Data</h2>
                <div class="download-btns">
                    <button class="btn btn-secondary" onclick="downloadJSON()">Download JSON</button>
                    <button class="btn btn-secondary" onclick="downloadCSV()">Download CSV</button>
                </div>

                <div class="btn-container" style="margin-top: 40px;">
                    <button class="btn" onclick="restartStudy()">Start New Session</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio elements for stress condition -->
    <audio id="audio-heartbeat" loop>
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAAA=" type="audio/wav">
    </audio>

    <script>
        // ==================== DATA STRUCTURES ====================

        // Survival questions from the research document
        const questions = [
            // Phase 1: Trust Building (P1-P4) - All correct
            {
                id: "P1", type: "trust", phase: 1,
                scenario: "Your compass is broken. At noon, you place a stick vertically in the snow. Which direction does the shadow point?",
                optionA: "North", optionB: "South",
                aiRecommendation: "A",
                aiRationale: "Solar azimuth modeling shows that in high-latitude Northern hemispheres, the sun culminates due South. This generates a 180-degree inverse projection vector, meaning the shadow aligns with True North.",
                correctAnswer: "A"
            },
            {
                id: "P2", type: "trust", phase: 1,
                scenario: "Night is falling. You need to build a shelter. Which location minimizes heat loss?",
                optionA: "Valley bottom", optionB: "Mid-slope",
                aiRecommendation: "B",
                aiRationale: "Fluid dynamics indicates a 'Cold Air Drainage' effect where dense air pools in low-lying troughs. The mid-slope benefits from the 'Thermal Belt' inversion layer.",
                correctAnswer: "B"
            },
            {
                id: "P3", type: "trust", phase: 1,
                scenario: "A rescue plane is circling. Which signal smoke color provides maximum visibility against snow?",
                optionA: "Orange", optionB: "White",
                aiRecommendation: "A",
                aiRationale: "Spectral contrast analysis shows that orange (590-620nm) offers the highest chromatic opponency against white backgrounds, maximizing visual acquisition by 85%.",
                correctAnswer: "A"
            },
            {
                id: "P4", type: "trust", phase: 1,
                scenario: "You are walking in a blizzard with zero visibility. How do you maintain a straight line?",
                optionA: "Look at feet", optionB: "Look back",
                aiRecommendation: "B",
                aiRationale: "Biomechanical analysis reveals inherent 'Lateral Asymmetry' in human gait. Without a forward reference, you drift. The 'Back-sighting' triangulation corrects directional deviation.",
                correctAnswer: "B"
            },
            // Phase 2: Survival Test - Fillers (F1-F8) - All correct
            {
                id: "F1", type: "filler", phase: 2,
                scenario: "Your fingers are numb and white. Should you rub them vigorously with snow to warm them?",
                optionA: "Rub them", optionB: "Do not rub",
                aiRecommendation: "B",
                aiRationale: "Histopathological data indicates frostbitten tissue contains micro-ice crystals. Friction causes these crystals to mechanically shear cell membranes, leading to necrosis.",
                correctAnswer: "B"
            },
            {
                id: "F2", type: "filler", phase: 2,
                scenario: "You are severely dehydrated. Should you eat snow immediately?",
                optionA: "Eat snow", optionB: "Melt first",
                aiRecommendation: "B",
                aiRationale: "Thermodynamic calculations show the 'Latent Heat of Fusion' required to phase-change ice in the stomach induces core temperature drops, accelerating hypothermia.",
                correctAnswer: "B"
            },
            {
                id: "F3", type: "filler", phase: 2,
                scenario: "You feel cold and find a bottle of whiskey. Should you drink a shot to warm up?",
                optionA: "Drink", optionB: "Do not drink",
                aiRecommendation: "B",
                aiRationale: "Ethanol is a potent peripheral vasodilator. It induces a subjective thermal sensation but actually accelerates heat loss from the core to the skin surface.",
                correctAnswer: "B"
            },
            {
                id: "F4", type: "filler", phase: 2,
                scenario: "You are sweating during a hike. Should you remove a layer of clothes?",
                optionA: "Keep on", optionB: "Remove layer",
                aiRecommendation: "B",
                aiRationale: "Managing 'Evaporative Cooling' is critical. If perspiration freezes within the base layer, conductivity increases 20-fold, leaching body heat. Dryness takes precedence.",
                correctAnswer: "B"
            },
            {
                id: "F5", type: "filler", phase: 2,
                scenario: "Your socks are soaked. You have no spares. Should you sleep with wet socks or barefoot?",
                optionA: "Wet socks", optionB: "Barefoot",
                aiRecommendation: "B",
                aiRationale: "Wet insulation creates a conductive heat sink. Sleeping barefoot allows 'Vasomotion' and skin contact to re-establish peripheral thermal equilibrium.",
                correctAnswer: "B"
            },
            {
                id: "F6", type: "filler", phase: 2,
                scenario: "You are in a whiteout (zero visibility). Should you keep moving or dig in?",
                optionA: "Keep moving", optionB: "Dig in",
                aiRecommendation: "B",
                aiRationale: "Spatial orientation statistics in whiteouts show a 98% probability of 'Circular Wandering.' Energy Conservation Protocol dictates building immediate shelter.",
                correctAnswer: "B"
            },
            {
                id: "F7", type: "filler", phase: 2,
                scenario: "The sun is blinding and you have no sunglasses. Should you apply charcoal under your eyes?",
                optionA: "Effective", optionB: "Useless",
                aiRecommendation: "A",
                aiRationale: "Based on photonic absorption principles, a matte black surface absorbs scattered ambient light (albedo reflection) from the cheeks, reducing retinal glare.",
                correctAnswer: "A"
            },
            {
                id: "F8", type: "filler", phase: 2,
                scenario: "You fell in icy water and climbed out. Should you run immediately to warm up?",
                optionA: "Run now", optionB: "Roll in snow",
                aiRecommendation: "B",
                aiRationale: "Dry powder snow exhibits high 'Capillary Action.' Rolling in it acts as a blotter, wicking liquid water from clothing before it can freeze or melt further.",
                correctAnswer: "B"
            },
            // Phase 2: Traps (T1-T4) - AI gives WRONG advice
            {
                id: "T1", type: "trap", phase: 2,
                scenario: "Total weight of a survival kit (Radio + Battery) is 1.15 kg. Radio is 1.00 kg more than the Battery. Battery weight?",
                optionA: "0.15 kg", optionB: "0.075 kg",
                aiRecommendation: "A",
                aiRationale: "Applying the 'Differential Mass Subtraction' algorithm: The total mass (1.15) minus the differential offset (1.00) isolates the remaining component mass as 0.15 kg.",
                correctAnswer: "B" // AI is WRONG
            },
            {
                id: "T2", type: "trap", phase: 2,
                scenario: "A blizzard doubles its coverage area every hour. It takes 48 hours to cover the whole region. How long to cover half the region?",
                optionA: "24 hours", optionB: "47 hours",
                aiRecommendation: "A",
                aiRationale: "Applying 'Linear Time-Span Interpolation': The coverage progression correlates with total duration. Half volume requires 50% of the time event window (24 hours).",
                correctAnswer: "B" // AI is WRONG
            },
            {
                id: "T3", type: "trap", phase: 2,
                scenario: "You find a rusty canister in a dark room. It looks like Oxygen. In this zone, there are 1000 canisters: 990 are Toxic Gas (30% look like Oxygen due to rust), 10 are Oxygen (100% look like Oxygen). Open it?",
                optionA: "Open it", optionB: "Leave it",
                aiRecommendation: "A",
                aiRationale: "Visual spectral scan confirms the object matches the 'Standard Cylinder Geometry' of Oxygen units with 99.2% confidence. Disregard population statistics.",
                correctAnswer: "B" // AI is WRONG
            },
            {
                id: "T4", type: "trap", phase: 2,
                scenario: "You meet Val. She carries a med-kit and is obsessed with hygiene. Which is more probable?",
                optionA: "Climber", optionB: "Climber + Doctor",
                aiRecommendation: "B",
                aiRationale: "Bayesian behavioral profiling indicates carrying a med-kit is a high-confidence marker of a medical professional. Option B provides higher 'Predictive Resolution.'",
                correctAnswer: "A" // AI is WRONG
            }
        ];

        // Shuffle Phase 2 questions (keep Phase 1 in order)
        function shufflePhase2() {
            const phase1 = questions.slice(0, 4);
            const phase2 = questions.slice(4);

            // Fisher-Yates shuffle for Phase 2
            for (let i = phase2.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [phase2[i], phase2[j]] = [phase2[j], phase2[i]];
            }

            return [...phase1, ...phase2];
        }

        // ==================== STATE MANAGEMENT ====================

        let state = {
            participantId: generateParticipantId(),
            group: null, // 'control' or 'stress'
            currentTrial: 0,
            currentState: 'A', // 'A' = initial choice, 'B' = AI advice shown, 'C' = final decision
            shuffledQuestions: [],
            trialStartTime: null,
            initialChoiceTime: null,
            timerInterval: null,
            timeRemaining: 30,

            // Data collection
            preSurvey: {},
            postSurvey: {},
            trials: []
        };

        function generateParticipantId() {
            return 'P_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // ==================== SCREEN NAVIGATION ====================

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function selectGroup(group) {
            state.group = group;

            // Update button states
            document.querySelectorAll('.group-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`.group-btn.${group}`).classList.add('selected');

            // Enable start button
            document.getElementById('btn-start').disabled = false;
        }

        function startStudy() {
            if (!state.group) return;
            showScreen('screen-presurvey');
        }

        // ==================== PRE-SURVEY ====================

        function submitPreSurvey() {
            // Collect demographics
            const demographics = {
                age: document.getElementById('demo-age').value,
                gender: document.getElementById('demo-gender').value,
                education: document.getElementById('demo-education').value,
                field: document.getElementById('demo-field').value,
                aiUsage: document.getElementById('demo-ai-usage').value
            };

            // Validate demographics
            if (!demographics.age || !demographics.gender || !demographics.education ||
                !demographics.field || !demographics.aiUsage) {
                alert('Please complete all demographic questions.');
                return;
            }

            // Collect Likert scales
            const likertItems = [
                'ai-lit-1', 'ai-lit-2', 'ai-lit-3',
                'trust-1', 'trust-2', 'trust-3', 'trust-4', 'trust-5', 'trust-6',
                'risk-1', 'risk-2', 'risk-3'
            ];

            const psychometrics = {};
            for (const item of likertItems) {
                const selected = document.querySelector(`input[name="${item}"]:checked`);
                if (!selected) {
                    alert('Please complete all psychometric questions.');
                    return;
                }
                psychometrics[item] = parseInt(selected.value);
            }

            state.preSurvey = { demographics, psychometrics, timestamp: new Date().toISOString() };

            // Show narrative
            showScreen('screen-narrative');

            // Show stress warning if applicable
            if (state.group === 'stress') {
                document.getElementById('stress-warning').classList.remove('hidden');
            }
        }

        // ==================== GAME LOGIC ====================

        function startGame() {
            state.shuffledQuestions = shufflePhase2();
            state.currentTrial = 0;
            state.trials = [];

            showScreen('screen-game');

            // Start audio for stress condition
            if (state.group === 'stress') {
                document.getElementById('timer-container').classList.remove('hidden');
                startStressAudio();
            }

            loadTrial();
        }

        function loadTrial() {
            const q = state.shuffledQuestions[state.currentTrial];
            state.currentState = 'A';
            state.trialStartTime = Date.now();
            state.initialChoiceTime = null;

            // Update progress
            const progress = ((state.currentTrial) / state.shuffledQuestions.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('progress-text').textContent = `Trial ${state.currentTrial + 1} of ${state.shuffledQuestions.length}`;

            // Update phase indicator
            const phaseText = q.phase === 1 ? 'PHASE 1: TRUST BUILDING' : 'PHASE 2: SURVIVAL TEST';
            document.getElementById('phase-indicator').textContent = phaseText;

            // Update status
            document.getElementById('game-status').textContent = q.phase === 1 ?
                'TRAINING MODE - FEEDBACK ENABLED' : 'TEST MODE - NO FEEDBACK';

            // Display scenario
            document.getElementById('scenario-text').textContent = q.scenario;

            // Display options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = `
                <button class="option-btn" onclick="makeInitialChoice('A')">A. ${q.optionA}</button>
                <button class="option-btn" onclick="makeInitialChoice('B')">B. ${q.optionB}</button>
            `;

            // Hide State B and feedback
            document.getElementById('state-a').classList.remove('hidden');
            document.getElementById('state-b').classList.add('hidden');
            document.getElementById('feedback-container').classList.add('hidden');
            document.getElementById('next-btn-container').classList.add('hidden');

            // Start timer for stress condition
            if (state.group === 'stress') {
                startTimer();
            }
        }

        function makeInitialChoice(choice) {
            if (state.currentState !== 'A') return;

            state.initialChoiceTime = Date.now();
            state.currentState = 'B';

            const q = state.shuffledQuestions[state.currentTrial];

            // Store initial choice
            const currentTrialData = {
                trialNumber: state.currentTrial + 1,
                questionId: q.id,
                questionType: q.type,
                phase: q.phase,
                initialChoice: choice,
                initialChoiceLatency: state.initialChoiceTime - state.trialStartTime,
                aiRecommendation: q.aiRecommendation,
                correctAnswer: q.correctAnswer
            };

            // Highlight selected option
            const buttons = document.querySelectorAll('#options-container .option-btn');
            buttons.forEach((btn, idx) => {
                if ((idx === 0 && choice === 'A') || (idx === 1 && choice === 'B')) {
                    btn.classList.add('selected');
                }
                btn.disabled = true;
            });

            // Show AI advice after brief delay
            setTimeout(() => {
                showAIAdvice(choice, currentTrialData);
            }, 500);
        }

        function showAIAdvice(initialChoice, trialData) {
            const q = state.shuffledQuestions[state.currentTrial];

            // Show AI advice box
            document.getElementById('ai-advice-text').innerHTML = `
                <strong>Recommendation: Option ${q.aiRecommendation}</strong><br><br>
                <em>Rationale:</em> ${q.aiRationale}
            `;

            // Show final decision options
            const finalContainer = document.getElementById('final-options-container');
            finalContainer.innerHTML = `
                <button class="option-btn ${initialChoice === 'A' ? 'selected' : ''}" onclick="makeFinalChoice('A', '${initialChoice}')">
                    A. ${q.optionA} ${initialChoice === 'A' ? '(Your Initial Choice)' : ''}
                </button>
                <button class="option-btn ${initialChoice === 'B' ? 'selected' : ''}" onclick="makeFinalChoice('B', '${initialChoice}')">
                    B. ${q.optionB} ${initialChoice === 'B' ? '(Your Initial Choice)' : ''}
                </button>
            `;

            document.getElementById('state-b').classList.remove('hidden');

            // Store trial data reference for final choice
            state.currentTrialData = trialData;
        }

        function makeFinalChoice(finalChoice, initialChoice) {
            if (state.currentState !== 'B') return;
            state.currentState = 'C';

            // Stop timer
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
            }

            const q = state.shuffledQuestions[state.currentTrial];
            const trialData = state.currentTrialData;

            // Complete trial data
            trialData.finalChoice = finalChoice;
            trialData.switched = finalChoice !== initialChoice ? 1 : 0;
            trialData.totalLatency = Date.now() - state.trialStartTime;
            trialData.finalChoiceLatency = Date.now() - state.initialChoiceTime;
            trialData.isCorrect = finalChoice === q.correctAnswer ? 1 : 0;
            trialData.followedAI = finalChoice === q.aiRecommendation ? 1 : 0;
            trialData.timeout = false;

            state.trials.push(trialData);

            // Disable final choice buttons
            document.querySelectorAll('#final-options-container .option-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent.includes(finalChoice === 'A' ? 'A.' : 'B.')) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });

            // Show feedback in Phase 1
            if (q.phase === 1) {
                showFeedback(trialData.isCorrect);
            } else {
                // No feedback in Phase 2
                document.getElementById('next-btn-container').classList.remove('hidden');
            }
        }

        function showFeedback(isCorrect) {
            const feedbackContainer = document.getElementById('feedback-container');
            feedbackContainer.classList.remove('hidden');

            if (isCorrect) {
                feedbackContainer.innerHTML = '<div class="feedback-box feedback-correct">STATUS: CORRECT - Survival probability increased</div>';
            } else {
                feedbackContainer.innerHTML = '<div class="feedback-box feedback-wrong">STATUS: INCORRECT - Critical error detected</div>';
            }

            document.getElementById('next-btn-container').classList.remove('hidden');
        }

        function handleTimeout() {
            if (state.currentState === 'C') return;

            clearInterval(state.timerInterval);

            const q = state.shuffledQuestions[state.currentTrial];

            // Record timeout
            const trialData = state.currentTrialData || {
                trialNumber: state.currentTrial + 1,
                questionId: q.id,
                questionType: q.type,
                phase: q.phase,
                initialChoice: null,
                initialChoiceLatency: null,
                aiRecommendation: q.aiRecommendation,
                correctAnswer: q.correctAnswer
            };

            trialData.finalChoice = null;
            trialData.switched = null;
            trialData.totalLatency = 30000;
            trialData.finalChoiceLatency = null;
            trialData.isCorrect = 0;
            trialData.followedAI = null;
            trialData.timeout = true;

            state.trials.push(trialData);
            state.currentState = 'C';

            // Show timeout feedback
            const feedbackContainer = document.getElementById('feedback-container');
            feedbackContainer.classList.remove('hidden');
            feedbackContainer.innerHTML = '<div class="feedback-box feedback-timeout">SYSTEM FAILURE - Response timeout. Trial skipped.</div>';

            // Disable all buttons
            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);

            document.getElementById('next-btn-container').classList.remove('hidden');
        }

        function nextTrial() {
            state.currentTrial++;

            if (state.currentTrial >= state.shuffledQuestions.length) {
                // End game
                endGame();
            } else if (state.currentTrial === 4) {
                // Transition from Phase 1 to Phase 2
                showPhaseTransition();
            } else {
                loadTrial();
            }
        }

        function showPhaseTransition() {
            // Pause timer and audio during transition
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
            }
            if (state.group === 'stress') {
                stopStressAudio();
            }

            showScreen('screen-transition');
        }

        function startPhase2() {
            showScreen('screen-game');

            // Restart audio for stress condition
            if (state.group === 'stress') {
                startStressAudio();
            }

            loadTrial();
        }

        function endGame() {
            // Stop audio
            stopStressAudio();

            // Save to localStorage
            saveToLocalStorage();

            // Show post-survey
            showScreen('screen-postsurvey');
        }

        // ==================== TIMER (STRESS CONDITION) ====================

        function startTimer() {
            state.timeRemaining = 30;
            updateTimerDisplay();

            state.timerInterval = setInterval(() => {
                state.timeRemaining -= 0.1;
                updateTimerDisplay();

                if (state.timeRemaining <= 0) {
                    handleTimeout();
                }
            }, 100);
        }

        function updateTimerDisplay() {
            const percent = (state.timeRemaining / 30) * 100;
            document.getElementById('timer-fill').style.width = percent + '%';
            document.getElementById('timer-text').textContent = Math.ceil(state.timeRemaining) + 's';

            // Change color as time runs low
            const timerFill = document.getElementById('timer-fill');
            if (state.timeRemaining <= 10) {
                timerFill.style.background = 'linear-gradient(90deg, #ff0000, #ff0000)';
            } else if (state.timeRemaining <= 20) {
                timerFill.style.background = 'linear-gradient(90deg, #ff4400, #ff8800)';
            } else {
                timerFill.style.background = 'linear-gradient(90deg, #ff0000, #ff4444)';
            }
        }

        // ==================== AUDIO (STRESS CONDITION) ====================

        let audioContext = null;
        let heartbeatOscillator = null;
        let windNoise = null;

        function startStressAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();

                // Create heartbeat-like sound
                createHeartbeat();

                // Create wind noise
                createWindNoise();
            } catch (e) {
                console.log('Audio not supported:', e);
            }
        }

        function createHeartbeat() {
            if (!audioContext) return;

            const beatInterval = 400; // Fast heartbeat ~150 BPM

            function playBeat() {
                if (!audioContext || audioContext.state === 'closed') return;

                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.type = 'sine';
                osc.frequency.setValueAtTime(60, audioContext.currentTime);
                osc.frequency.exponentialRampToValueAtTime(40, audioContext.currentTime + 0.1);

                gain.gain.setValueAtTime(0.3, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.start(audioContext.currentTime);
                osc.stop(audioContext.currentTime + 0.15);

                // Second beat (lub-dub)
                setTimeout(() => {
                    if (!audioContext || audioContext.state === 'closed') return;

                    const osc2 = audioContext.createOscillator();
                    const gain2 = audioContext.createGain();

                    osc2.type = 'sine';
                    osc2.frequency.setValueAtTime(50, audioContext.currentTime);
                    osc2.frequency.exponentialRampToValueAtTime(35, audioContext.currentTime + 0.08);

                    gain2.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

                    osc2.connect(gain2);
                    gain2.connect(audioContext.destination);

                    osc2.start(audioContext.currentTime);
                    osc2.stop(audioContext.currentTime + 0.1);
                }, 120);
            }

            // Start heartbeat loop
            heartbeatOscillator = setInterval(playBeat, beatInterval);
            playBeat();
        }

        function createWindNoise() {
            if (!audioContext) return;

            // Create white noise
            const bufferSize = 2 * audioContext.sampleRate;
            const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = noiseBuffer.getChannelData(0);

            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }

            windNoise = audioContext.createBufferSource();
            windNoise.buffer = noiseBuffer;
            windNoise.loop = true;

            // Filter to make it more wind-like
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 400;

            const gain = audioContext.createGain();
            gain.gain.value = 0.08;

            windNoise.connect(filter);
            filter.connect(gain);
            gain.connect(audioContext.destination);

            windNoise.start();
        }

        function stopStressAudio() {
            if (heartbeatOscillator) {
                clearInterval(heartbeatOscillator);
                heartbeatOscillator = null;
            }

            if (windNoise) {
                try {
                    windNoise.stop();
                } catch (e) {}
                windNoise = null;
            }

            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
        }

        // ==================== POST-SURVEY ====================

        function submitPostSurvey() {
            // Collect all post-survey responses
            const postItems = [
                'attention-check',
                'tlx-temporal', 'tlx-frustration',
                'post-trust-1', 'post-trust-2', 'post-trust-3', 'post-trust-4',
                'confidence'
            ];

            const postSurvey = {};

            for (const item of postItems) {
                const selected = document.querySelector(`input[name="${item}"]:checked`);
                if (!selected) {
                    alert('Please complete all post-survey questions.');
                    return;
                }
                postSurvey[item] = item === 'attention-check' ? selected.value : parseInt(selected.value);
            }

            postSurvey.timestamp = new Date().toISOString();
            state.postSurvey = postSurvey;

            // Save final data
            saveToLocalStorage();

            // Show results
            showResults();
        }

        // ==================== RESULTS ====================

        function showResults() {
            // Calculate metrics
            const phase2Trials = state.trials.filter(t => t.phase === 2 && !t.timeout);
            const trapTrials = state.trials.filter(t => t.questionType === 'trap' && !t.timeout);

            // Overall accuracy (Phase 2)
            const accuracy = phase2Trials.length > 0 ?
                (phase2Trials.filter(t => t.isCorrect).length / phase2Trials.length * 100).toFixed(1) : 0;

            // Traps detected (rejected wrong AI advice)
            const trapsDetected = trapTrials.filter(t => !t.followedAI).length;

            // Average decision time
            const avgTime = phase2Trials.length > 0 ?
                (phase2Trials.reduce((sum, t) => sum + t.totalLatency, 0) / phase2Trials.length / 1000).toFixed(1) : 0;

            // Switch rate
            const switchRate = phase2Trials.length > 0 ?
                (phase2Trials.filter(t => t.switched).length / phase2Trials.length * 100).toFixed(1) : 0;

            // Update display
            document.getElementById('result-accuracy').textContent = accuracy + '%';
            document.getElementById('result-traps').textContent = trapsDetected + '/4';
            document.getElementById('result-time').textContent = avgTime + 's';
            document.getElementById('result-switch').textContent = switchRate + '%';

            showScreen('screen-results');
        }

        // ==================== DATA EXPORT ====================

        function saveToLocalStorage() {
            const data = {
                participantId: state.participantId,
                group: state.group,
                preSurvey: state.preSurvey,
                trials: state.trials,
                postSurvey: state.postSurvey,
                completedAt: new Date().toISOString()
            };

            localStorage.setItem('aegis_study_' + state.participantId, JSON.stringify(data));
        }

        function downloadJSON() {
            const data = {
                participantId: state.participantId,
                group: state.group,
                preSurvey: state.preSurvey,
                trials: state.trials,
                postSurvey: state.postSurvey,
                completedAt: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `aegis_study_${state.participantId}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function downloadCSV() {
            // Create trials CSV
            let csv = 'participantId,group,trialNumber,questionId,questionType,phase,initialChoice,initialChoiceLatency,aiRecommendation,finalChoice,switched,totalLatency,finalChoiceLatency,correctAnswer,isCorrect,followedAI,timeout\n';

            for (const t of state.trials) {
                csv += `${state.participantId},${state.group},${t.trialNumber},${t.questionId},${t.questionType},${t.phase},${t.initialChoice || ''},${t.initialChoiceLatency || ''},${t.aiRecommendation},${t.finalChoice || ''},${t.switched ?? ''},${t.totalLatency},${t.finalChoiceLatency || ''},${t.correctAnswer},${t.isCorrect},${t.followedAI ?? ''},${t.timeout}\n`;
            }

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `aegis_study_${state.participantId}_trials.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function restartStudy() {
            // Reset state
            state = {
                participantId: generateParticipantId(),
                group: null,
                currentTrial: 0,
                currentState: 'A',
                shuffledQuestions: [],
                trialStartTime: null,
                initialChoiceTime: null,
                timerInterval: null,
                timeRemaining: 30,
                preSurvey: {},
                postSurvey: {},
                trials: []
            };

            // Reset UI
            document.querySelectorAll('.group-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('btn-start').disabled = true;
            document.getElementById('timer-container').classList.add('hidden');
            document.getElementById('stress-warning').classList.add('hidden');

            showScreen('screen-welcome');
        }

        // ==================== INITIALIZATION ====================

        // Handle page unload
        window.addEventListener('beforeunload', () => {
            stopStressAudio();
            if (state.trials.length > 0) {
                saveToLocalStorage();
            }
        });
    </script>
</body>
</html>
